{% extends 'base.html' %}
{% block title %}Dashboard{% endblock %}
{% block content %}
<h1 class="mb-4">Dashboard</h1>
{% set has_running = tasks|selectattr('task.status', 'equalto', 'RUNNING')|list|length > 0 %}
{% if has_running %}
<script>
  (function refreshJobs(){
    fetch("{{ url_for('dashboard_jobs') }}")
      .then(resp => resp.text())
      .then(html => {
        const section = document.getElementById("jobs-section");
        section.innerHTML = html;
        if (html.indexOf(">RUNNING<") !== -1) {
          setTimeout(refreshJobs, 5000);
        }
      });
  })();
</script>
{% endif %}
<h2>Submit a new task</h2>
<div class="mb-4">
  {% for key, cfg in configs.items() %}
  <form action="{{ url_for('submit_task', task_type=key) }}" method="post" class="d-inline-block me-3">
    <div class="input-group">
      {% if key == 'fractal' %}
      <input type="number" name="depth" class="form-control" min="0" placeholder="Depth" required>
      {% elif key == 'primes' %}
      <input type="number" name="n" class="form-control" min="2" placeholder="N" required>
      {% endif %}
      <button class="btn btn-primary" type="submit">Submit {{ key|capitalize }}</button>
    </div>
  </form>
  {% endfor %}
</div>
<div id="jobs-section">
  {% include '_jobs_table.html' %}
</div>
{% endblock %}
